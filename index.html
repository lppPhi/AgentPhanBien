<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tranh Luận AI</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 text-gray-900">
  <div class="max-w-3xl mx-auto p-6 space-y-6">
    <h1 class="text-3xl font-bold text-center">🧠 Tranh luận cùng AI</h1>

    <textarea id="topicInput" placeholder="Nhập chủ đề tranh luận (VD: AI có nên thay thế giáo viên?)" class="w-full p-3 border border-gray-300 rounded min-h-[100px]"></textarea>
    <button onclick="startDebate()" id="debateBtn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50">
      Bắt đầu tranh luận
    </button>

    <div id="resultContainer" class="space-y-4 hidden">
      <div class="bg-white p-4 border border-gray-300 rounded">
        <strong class="text-lg">💬 Cuộc tranh luận:</strong>
        <div class="mt-2 space-y-4 text-sm">
          <div>
            <p class="font-semibold text-blue-700">
              🅰️ Debater A - Vòng 1:
              <button onclick="speakText('a1')" class="ml-2 text-sm text-blue-500 hover:underline">🔊 Nghe</button><button onclick="stopSpeaking()" class="ml-2 text-sm text-red-500 hover:underline">🛑 Dừng đọc</button>
            </p>
            <pre id="a1" class="whitespace-pre-wrap text-gray-800"></pre>
          </div>
          <div>
            <p class="font-semibold text-red-700">
              🅱️ Debater B - Vòng 1:
              <button onclick="speakText('b1')" class="ml-2 text-sm text-red-500 hover:underline">🔊 Nghe</button><button onclick="stopSpeaking()" class="ml-2 text-sm text-red-500 hover:underline">🛑 Dừng đọc</button>
            </p>
            <pre id="b1" class="whitespace-pre-wrap text-gray-800"></pre>
          </div>
          <div>
            <p class="font-semibold text-blue-700">
              🅰️ Debater A - Vòng 2:
              <button onclick="speakText('a2')" class="ml-2 text-sm text-blue-500 hover:underline">🔊 Nghe</button><button onclick="stopSpeaking()" class="ml-2 text-sm text-red-500 hover:underline">🛑 Dừng đọc</button>
            </p>
            <pre id="a2" class="whitespace-pre-wrap text-gray-800"></pre>
          </div>
          <div>
            <p class="font-semibold text-red-700">
              🅱️ Debater B - Vòng 2:
              <button onclick="speakText('b2')" class="ml-2 text-sm text-green-500 hover:underline">🔊 Nghe</button><button onclick="stopSpeaking()" class="ml-2 text-sm text-red-500 hover:underline">🛑 Dừng đọc</button>
            </p>
            <pre id="b2" class="whitespace-pre-wrap text-gray-800"></pre>
          </div>
        </div>
      </div>

      <div class="bg-green-50 p-4 border border-green-300 rounded">
        <strong class="text-lg">✅ Kết quả:
          <button onclick="speakText('resultOutput')" class="ml-2 text-sm text-green-600 hover:underline">🔊 Nghe</button><button onclick="stopSpeaking()" class="ml-2 text-sm text-red-500 hover:underline">🛑 Dừng đọc</button>
        </strong>
        <pre id="resultOutput" class="mt-2 whitespace-pre-wrap text-green-700"></pre>
      </div>
    </div>
  </div>

  <script>
    let voices = [];

    function loadVoices() {
      voices = speechSynthesis.getVoices();
      if (!voices.length) {
        setTimeout(loadVoices, 100);
      }
    }

    window.speechSynthesis.onvoiceschanged = loadVoices;
    loadVoices();

    async function startDebate() {
      const btn = document.getElementById("debateBtn");
      const topic = document.getElementById("topicInput").value;
      if (!topic.trim()) return;

      btn.disabled = true;
      btn.textContent = "Đang xử lý...";

      const response = await fetch("http://localhost:8000/debate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ topic })
      });

      const data = await response.json();

      document.getElementById("a1").textContent = data.a1;
      document.getElementById("b1").textContent = data.b1;
      document.getElementById("a2").textContent = data.a2;
      document.getElementById("b2").textContent = data.b2;
      document.getElementById("resultOutput").textContent = data.result;
      document.getElementById("resultContainer").classList.remove("hidden");

      btn.disabled = false;
      btn.textContent = "Bắt đầu tranh luận";
    }

    function speakText(id) {
      const text = document.getElementById(id).textContent;
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "vi-VN";

      const allViVoices = voices.filter(v => v.lang === "vi-VN");

      // Chọn giọng khác nhau cho mỗi vai nếu có nhiều hơn 1 giọng
      if (allViVoices.length > 1) {
        if (id.startsWith("a")) utterance.voice = allViVoices[0];
        else if (id.startsWith("b")) utterance.voice = allViVoices[1];
        else utterance.voice = allViVoices[0];
      } else {
        utterance.voice = allViVoices[0];
      }

      speechSynthesis.cancel();
      speechSynthesis.speak(utterance);
    }

    function stopSpeaking() {
      speechSynthesis.cancel();
    }
  </script>
</body>
</html>
